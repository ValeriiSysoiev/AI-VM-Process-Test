# Machine-Readable Architecture (MRA): Vulnerability Management Orchestration Template

---

## 1. Solution Overview

The Vulnerability Management Orchestration Template is a modular, AI-powered automation solution for managing, triaging, and remediating vulnerabilities across cloud and enterprise environments. This MRA document defines a reference architecture, deployment pattern, and code scaffolding designed to be easily adapted for client-specific implementations.

**Key Capabilities:**
- Multi-source ingestion (Nexpose, Wiz, Defender, WebApp Scanners)
- Modular AI agent orchestration (Microsoft Foundry + Azure OpenAI)
- Human-in-the-loop risk validation and approval
- Automated ITSM integration for remediation (ServiceNow, Jira)
- Real-time dashboards and compliance reporting (Power BI)
- Full Azure-native security, secrets, and logging

## 2. Architecture Overview

This architecture orchestrates the end-to-end lifecycle of vulnerability management, integrating multi-source scanners, AI agents, human-in-the-loop decision points, and automated remediation/reporting‚Äîall running in a secure, scalable Azure environment.

### **High-Level Workflow:**
1. Security Analyst triggers ingestion via the User Portal (Web UI).
2. Orchestrator AI Agent coordinates data collection through Ingestion Agents (Nexpose, Wiz, Defender, WebApp Scanner).
3. All findings are normalized, deduplicated, and enriched with context by the Processing Agents.
4. Triage & Risk Scoring AI Agent (LLM) analyzes the data, assigns risk scores, and recommends actions.
5. Human-in-the-loop Approval ensures that no critical vulnerability moves forward without expert review and sign-off.
6. Upon approval, the Remediation Agent generates ITSM tickets (ServiceNow, Jira) for resolution.
7. The Reporting Agent produces real-time dashboards and compliance reports, integrated with Power BI.
8. Every action, approval, and decision is logged in Cosmos DB and monitored via Azure-native monitoring and auditing tools.

---

### **Component Overview:**

| Component               | Description                                                                          |
|-------------------------|--------------------------------------------------------------------------------------|
| **User Portal (Web UI)**    | Entry point for analysts to initiate workflows and review results                  |
| **Orchestrator AI Agent**   | Coordinates workflow, agent calls, and error handling                              |
| **Ingestion Agents**        | Pull vulnerabilities from Nexpose, Wiz, Defender, WebApp Scanner                   |
| **Processing Agents**       | Normalize, deduplicate, and enrich all findings                                   |
| **Triage & Risk Agent**     | Assigns risk scores using Azure OpenAI (LLM)                                      |
| **Human-in-the-Loop**       | Approval and override step for security analysts                                  |
| **Remediation Agent**       | Automates ticket creation in ITSM (ServiceNow, Jira)                              |
| **Reporting Agent**         | Generates reports, updates Power BI dashboards                                    |
| **Azure Cloud Services**    | Key Vault (secrets), Cosmos DB (storage/logs), OpenAI/Foundry, Monitoring/Audit   |

---

### **Architecture Diagram**

**Architecture Diagram:** This diagram illustrates the end-to-end AI-powered Vulnerability Management workflow


![[../02_Diagrams/Architecture_Diagram.png]]



**Diagram Code:**
```eraser#

// Title

title Vulnerability Management Orchestration Architecture (Clear, Grouped, Annotated), Grouped, Annotated), Grouped, Annotated), Grouped, Annotated), Grouped, Annotated), Grouped, Annotated)



// USER LAYER

User Layer [icon: user] {

Security Analyst [icon: user]

User Portal [icon: monitor, label: "Web UI"]

}



// ORCHESTRATION LAYER

Orchestration Layer [icon: robot] {

Orchestrator AI Agent [icon: robot, label: "FastAPI Orchestrator AI Agent"]

}



// INGESTION AGENTS LAYER

Ingestion Agents [color: blue, icon: robot] {

Nexpose AI Agent [icon: robot, label: "Nexpose"]

Wiz AI Agent [icon: robot, label: "Wiz"]

Defender AI Agent [icon: robot, label: "Defender"]

WebApp Scanner AI Agent [icon: robot, label: "WebApp Scanner"]

}



// PROCESSING LAYER

Processing [color: green, icon: cpu] {

Deduplication & Normalization [icon: filter, label: "Deduplication"]

Enrichment AI Agent [icon: robot, label: "Enrichment (AI Agent)"]

Triage & Risk Scoring AI Agent [icon: robot, label: "Triage & Risk Scoring (LLM AI Agent)"]

}



// HUMAN REVIEW LAYER

Human Review [color: yellow, icon: user-check] {

Review & Approval [icon: user-check, label: "Human-in-the-Loop Approval"]

}



// REMEDIATION & REPORTING LAYER

Remediation & Reporting [color: orange, icon: check-circle] {

Ticketing Agent [icon: jira, label: "Remediation/Ticketing (SNOW/Jira)"]

Reporting AI Agent [icon: robot, label: "Reporting (AI Agent)"]

Dashboard Output [icon: file-text, label: "Dashboard/Report Output"]

Power BI Dashboard [icon: powerbi, label: "Power BI (Microsoft)"]

Power BI Note [icon:info, label:"All reporting and compliance dashboards are powered by Microsoft Power BI."]

}



// AZURE CLOUD SERVICES LAYER

Azure Cloud Services [color: gray, icon: cloud] {

Azure OpenAI Foundry [icon: azure-openai, label: "OpenAI (Foundry)"]

Azure Cosmos DB [icon: azure-cosmos-db, label: "Cosmos DB"]

Azure Key Vault [icon: azure-key-vault, label: "Key Vault"]

Monitoring & Audit [icon: activity, label: "Monitoring & Audit"]

KeyVaultCallout [label: "All agents retrieve credentials from Azure Key Vault.", icon: info]

}



// MAIN WORKFLOW (solid arrows)

Security Analyst > User Portal : "user actions"

User Portal > Orchestrator AI Agent : "trigger workflow"

Ticketing Agent > Reporting AI Agent : "remediation ticket"

Reporting AI Agent > Dashboard Output : "report"

Reporting AI Agent > Power BI Dashboard : "exec dashboard"

Dashboard Output > Power BI Dashboard : "dashboard sync"



// AI/LLM CALLS

Triage & Risk Scoring AI Agent > Azure OpenAI Foundry : "AI risk scoring"

Reporting AI Agent > Azure OpenAI Foundry : "AI summary"



// LOGGING (dashed arrows)

Review & Approval --> Azure Cosmos DB : "log approval"

Ticketing Agent --> Azure Cosmos DB : "log ticket"



// KEY VAULT SECRETS (dotted arrows)

"Nexpose AI Agent ...> Azure Key Vault : "get secrets""

"Wiz AI Agent ...> Azure Key Vault : "get secrets""

"Defender AI Agent ...> Azure Key Vault : "get secrets""

"WebApp Scanner AI Agent ...> Azure Key Vault : "get secrets""

"Ticketing Agent ...> Azure Key Vault : "get secrets""

"Orchestrator AI Agent ...> Azure Key Vault : "get secrets""



// MONITORING & AUDIT (dotted/dashed arrows)

"Azure Cosmos DB ...> Monitoring & Audit : "audit log""

"Orchestrator AI Agent ...> Monitoring & Audit : "monitor ops""

"Reporting AI Agent ...> Monitoring & Audit : "report delivery""

"Power BI Dashboard ...> Monitoring & Audit : "dashboard access""

Azure Cosmos DB --> Monitoring & Audit: "audit/monitor logs"

Ingestion Agents <> Deduplication & Normalization: "vuln data"

Deduplication & Normalization --> Azure Cosmos DB: "log"

Enrichment AI Agent --> Azure Cosmos DB: "log"

Triage & Risk Scoring AI Agent --> Azure Cosmos DB: "log"

Reporting AI Agent --> Azure Cosmos DB: "log"

Dashboard Output --> Azure Cosmos DB: "log"

Power BI Dashboard --> Azure Cosmos DB: "log"

Processing > Human Review: "prioritized"

Human Review > Remediation & Reporting: "approved"

Orchestration Layer > Azure Key Vault: "retrieve keys"

Ingestion Agents > Azure Key Vault: "retrieve keys"

Enrichment AI Agent > Azure Key Vault: "retrieve keys"

Triage & Risk Scoring AI Agent > Azure Key Vault: "retrieve keys"

Reporting AI Agent > Azure Key Vault: "retrieve keys"

Orchestration Layer > Ingestion Agents: trigger ingestion

Deduplication & Normalization > Enrichment AI Agent: "normalized"

Enrichment AI Agent > Triage & Risk Scoring AI Agent: enriched




---
## 3. Component Descriptions

This section details each major component and agent in the architecture, specifying purpose, workflow role, expected inputs/outputs, dependencies, and key configuration parameters.

---

### 3.1 User Portal (Web UI)

- **Purpose:**
  Entry point for security analysts to initiate scans, review prioritized vulnerabilities, and approve or reject remediation recommendations.

- **Inputs:**
  Analyst actions (e.g., trigger ingestion, approve/reject triage, request report).

- **Outputs:**
  Workflow triggers to Orchestrator AI Agent; approval/rejection signals; review logs.

- **Dependencies:**
  Authenticated session (Azure AD/SSO), API calls to Orchestrator service.

- **Config:**
  API endpoint, auth config, UI branding (client-specific).

---

### 3.2 Orchestrator AI Agent

- **Purpose:**
  Central workflow coordinator; invokes ingestion, processing, triage, remediation, and reporting agents in sequence.

- **Inputs:**
  User portal triggers, scheduled jobs, external system events.

- **Outputs:**
  Calls to agents (APIs/functions), workflow status, error logs.

- **Dependencies:**
  Azure Container Apps, Azure Key Vault (for secrets), message bus (if used).

- **Config:**
  List of agent endpoints, workflow config, error-handling policies.

---

### 3.3 Ingestion Agents

- **Purpose:**
  Connects to vulnerability scanners (Nexpose, Wiz, Defender, WebApp Scanner), fetches findings, and normalizes results.

- **Inputs:**
  API credentials, scan parameters (date range, asset scope).

- **Outputs:**
  Standardized findings (JSON/YAML schema).

- **Dependencies:**
  Third-party scanner APIs, Azure Key Vault (for credentials).

- **Config:**
  API base URLs, tokens, polling schedule.

---

### 3.4 Processing Agents

- **Purpose:**
  Normalize, deduplicate, and enrich vulnerability findings with asset context or threat intelligence.

- **Inputs:**
  Findings from Ingestion Agents.

- **Outputs:**
  Cleaned, enriched findings.

- **Dependencies:**
  Data enrichment sources (asset DB, threat feeds), deduplication logic.

- **Config:**
  Schema mapping, enrichment API keys (if any).

---

### 3.5 Triage & Risk Scoring AI Agent (LLM)

- **Purpose:**
  Assigns risk scores and recommended actions using Azure OpenAI LLM.

- **Inputs:**
  Enriched findings, context.

- **Outputs:**
  Risk score, recommended remediation, rationale/explanation.

- **Dependencies:**
  Azure OpenAI/Foundry endpoint, model deployment.

- **Config:**
  Model name, prompt template, risk scoring rules.

---

### 3.6 Human-in-the-Loop Approval

- **Purpose:**
  Enables analyst review and sign-off of critical vulnerabilities and remediation steps.

- **Inputs:**
  AI agent output, context from processing agents.

- **Outputs:**
  Approval/rejection, override notes, audit logs.

- **Dependencies:**
  Web UI, approval workflow logic.

- **Config:**
  Escalation policy, approval thresholds.

---

### 3.7 Remediation Agent

- **Purpose:**
  Automates ticket creation and status updates in ITSM platforms (ServiceNow, Jira).

- **Inputs:**
  Approved findings, risk level, remediation instructions.

- **Outputs:**
  Ticket IDs, ticket status, remediation logs.

- **Dependencies:**
  ITSM APIs, Key Vault (for creds).

- **Config:**
  ITSM API URL, field mapping, escalation contacts.

---

### 3.8 Reporting Agent

- **Purpose:**
  Generates dashboards, compliance reports, and executive summaries; updates Power BI.

- **Inputs:**
  Remediation and approval logs, risk trends.

- **Outputs:**
  Power BI dashboards, email reports, audit logs.

- **Dependencies:**
  Power BI API, reporting templates.

- **Config:**
  Dashboard layout, report schedule, notification recipients.

---

### 3.9 Azure Cloud Services

- **Purpose:**
  Provides all supporting services for secrets (Key Vault), storage/logging (Cosmos DB), AI (OpenAI/Foundry), and monitoring.

- **Config:**
  Resource names/IDs, access policies, region/SKU, monitoring/alert rules.

---

*(Add new components or agents here as needed. For each, specify purpose, workflow role, expected inputs/outputs, dependencies, and config. Codex/codegen will scaffold agent stubs, API endpoints, and config files accordingly.)*

## 4. Data Models & API Contracts

This section defines the primary data structures (schemas) and API contracts used across the Vulnerability Management Orchestration solution.
Each agent and service should strictly follow these models for reliable data exchange and extensibility.

---

### 4.1 Vulnerability Finding (Core Data Model)

```json
{
  "vuln_id": "CVE-2025-12345",
  "scanner": "Nexpose",
  "asset_id": "SRV-001",
  "risk_rating": "High",
  "description": "Buffer overflow in ...",
  "date_detected": "2025-07-07",
  "enrichment": {
    "asset_owner": "jdoe@company.com",
    "business_criticality": "Critical"
  },
  "risk_score": 85,
  "status": "Pending"
}
```
---
### 4.2 Ingestion Agent API Contract

- **Endpoint:** `POST /api/ingest`
- **Request Body:**
```json
{
  "start_date": "2025-07-01",
  "end_date": "2025-07-07"
}
```
- **Response:**
```json
    {   "findings": [ { ...Vulnerability Finding... } ],   "job_id": "job-001",   "status": "completed" }

```
---
### 4.3 Triage & Risk Scoring Agent API Contract

- **Endpoint:** `POST /api/triage`
- **Request Body:**
    A single normalized finding, as above.

- **Response:**
```json
    {   "vuln_id": "CVE-2025-12345",   "risk_score": 92,   "recommended_action": "Create ticket",   "explanation": "Critical vuln on a core server with exploit in the wild." }
```
---

### 4.4 Remediation Agent API Contract

- **Endpoint:** `POST /api/remediate`

- **Request Body:**
```json
    {   "vuln_id": "CVE-2025-12345",   "action": "create_ticket",   "assignee": "it_team" }
```
- **Response:**
```json
    {   "ticket_id": "SN-56789",   "status": "created" }
```
### 4.5 Report API Contract

- **Endpoint:** `GET /api/report`
- **Response:**
```json
{"total_items": 3}
```

### 4.6 Reporting Agent Output (Power BI Data Feed Example)
```json
{
  "dashboard_id": "pbi-vm-dashboard",
  "reporting_period": "2025-07",
  "open_findings": 32,
  "resolved_this_period": 11,
  "avg_time_to_remediate_days": 4.2,
  "sla_breaches": 1,
  "risk_trend": "downward"
}
```
---

## 5. Infrastructure Architecture & Provisioning (IaC)

This section describes the Azure infrastructure required to support the Vulnerability Management Orchestration solution, and how all resources are provisioned as code for repeatable, secure deployment.

---

### 5.1 Azure Resources Overview

| Resource                   | Purpose                                                       |
|----------------------------|---------------------------------------------------------------|
| **Azure Container Apps**   | Runs all agents (orchestrator, ingestion, triage, reporting) as microservices |
| **Azure OpenAI (Foundry)** | Provides LLM-powered risk triage, recommendations, summaries  |
| **Azure Cosmos DB**        | Stores findings, tickets, audit logs, and workflow state      |
| **Azure Key Vault**        | Stores API keys, credentials, connection strings (secrets)    |
| **Azure Application Insights** | Telemetry, traces, and application monitoring             |
| **Azure Log Analytics**    | Centralized log collection, compliance, and SIEM integration  |
| **Azure Power BI**         | Reporting and executive dashboard platform                    |
| **(Optional) Azure Cognitive Search** | RAG, enrichment, or knowledge base lookup         |

---

### 5.2 Infrastructure-as-Code (IaC) Approach

- All Azure resources are **defined in Bicep templates** and deployed using the **Azure Developer CLI (`azd`)** for consistency, security, and fast onboarding.
- The repo contains an `infra/` folder with Bicep modules for each major resource (e.g., `main.bicep`, `containerapps.bicep`, `openai.bicep`, `cosmos.bicep`, `keyvault.bicep`).
- Environments (dev, test, prod) are parameterized for region, scaling, model capacity, and secrets.

**Example structure:**
```plaintext
/infra/
  main.bicep
  containerapps.bicep
  openai.bicep
  cosmos.bicep
  keyvault.bicep
  monitoring.bicep
  (others as needed)
  ```

### 5.3 Azure Developer CLI (`azd`) Configuration

- An `azure.yaml` file maps app source code and services to provisioned resources.

- Each microservice (agent/orchestrator) is associated with a specific Azure Container App.

- Example:
```yaml
services:
  orchestrator:
    project: ./src/orchestrator
    host: containerapp
    language: python
  ingestion_agents:
    project: ./src/agents/ingestion
    host: containerapp
    language: python
    ```

Environment variables and secrets are injected at deploy-time (never hardcoded).

### 5.4 Security & Best Practices

- **All secrets are managed in Key Vault**‚Äîno credentials in code or plain config files.

- **Managed identities** are used for agent/container access to Key Vault, Cosmos DB, and other resources.

- **Diagnostic logging, monitoring, and alerting** enabled on all resources (Application Insights, Log Analytics).

- **Resource naming conventions and tagging** for easy management and cost allocation.

- **Network isolation** (Container Apps environment can run in a VNet, Key Vault/Cosmos use Private Endpoints for high security).

- **All infra code is versioned and reviewed in the template repo**.

---

### 5.5 Quick Deployment Steps

1. **Clone or fork this template repo**

2. **Update config parameters** (`.env`, `azure.yaml`, Bicep params) for your environment and client

3. **Run `azd up`** to provision all Azure resources and deploy app code

4. **Review Application Insights and Log Analytics for initial monitoring**

5. **Customize front end and agents as needed**


---

_For a detailed resource list, see `/05_Infrastructure/` folder and Bicep templates.
For ‚Äúhow to adapt‚Äù for clients, see the repo‚Äôs README or next section.__

## 6. Repository Structure & Setup

This section defines the standard folder and file layout for the Vulnerability Management Orchestration template repository.
Following this structure enables rapid onboarding, modular agent development, and seamless configuration for new clients.

---

### 6.1 Recommended Directory Structure

```plaintext
/
  01_Architecture/
    MRA_Vulnerability_Management.md
  02_Diagrams/
    Architecture_Diagram.md
    Architecture_Diagram.png
  03_DataSchemas/
    finding_schema.json
    agent_config_schema.yaml
  04_API_Contracts/
    ingestion_api_openapi.yaml
    triage_api_openapi.yaml
  05_Infrastructure/
    main.bicep
    containerapps.bicep
    cosmos.bicep
    openai.bicep
    keyvault.bicep
  06_DevOps/
    azure.yaml
    github_actions.yaml
    deployment_scripts/
  07_Reference/
    MS_accelerator_links.md
    ISO_controls_mapping.md
  src/templates/
    agent_stub.py
    config_template.env
  src/
    orchestrator/
    agents/
      ingestion/
      triage/
      remediation/
      reporting/
    frontend/
  .env.sample
  README.md
  LICENSE
```
### 6.2 Quick Start & Setup

1. **Clone or fork the template repository**

2. **Install required tools:**

    - [Azure Developer CLI (`azd`)](https://learn.microsoft.com/en-us/azure/developer/azure-developer-cli/install-azd)

    - [Python 3.11+](https://www.python.org/downloads/) (for agents and orchestrator)

    - [Node.js 18+](https://nodejs.org/) (for front end, if using React/Vue)

3. **Copy `.env.sample` to `.env`** and fill in environment-specific secrets, endpoints, and config parameters.

4. **Review and update `/05_Infrastructure/` Bicep templates** as needed for region, scaling, resource group names.

5. **Run `azd up`** to provision Azure resources and deploy code.

6. **Access the User Portal** (front end) and test ingestion, triage, and remediation workflows.

7. **Review logs and dashboards** in Application Insights, Log Analytics, and Power BI.


---

### 6.3 Recommended Git Practices

- Use **feature branches** for new agents, major config changes, or IaC updates.

- Open **Pull Requests** with clear titles and descriptions‚Äîlink to related requirements or architecture notes.

- **Commit IaC, agent code, and data schemas together** for atomic, repeatable deployments.

- Never commit secrets‚Äî**use Key Vault and `.env.sample` only**.

- Tag releases and major template updates (e.g., `v1.0`, `client-xyz-onboard`).

- Document new agent/config changes in `/01_Architecture/MRA_Vulnerability_Management.md` and update `src/templates/` as needed.


---

_For full development and deployment details, see the README.md in the repo root and `/01_Architecture/MRA_Vulnerability_Management.md`._

## 7. Security, Compliance & Auditability

This solution is designed to meet enterprise and regulatory security requirements by default, aligning with key standards such as **ISO/IEC 27001**, **ISO/IEC 42001**, and **ISO/IEC 42005**.
All controls and design choices follow the [Deloitte AI Agent Security Framework](../07_Reference/Deloitte AI Agent Security Framework.pdf) (see reference).

---

### 7.1 Security Controls

- **Secrets & Credentials:**
  - All API keys, credentials, and sensitive config are stored in **Azure Key Vault**.
  - No secrets are ever stored in code or plain configuration files.
- **Identity & Access Management:**
  - **Azure AD/SSO** is used for all analyst and administrator access.
  - All agents use **managed identities** for access to Key Vault, Cosmos DB, and Azure APIs.
- **Network & Resource Isolation:**
  - Container Apps and back-end services can run in **isolated VNets**.
  - Private endpoints for Key Vault and Cosmos DB restrict access to the internal network.
- **Role-Based Access Control (RBAC):**
  - All resources, dashboards, and workflow actions are protected by fine-grained RBAC policies.
- **Least Privilege:**
  - Each agent/service only has access to the minimum required data and operations.

---

### 7.2 Compliance Alignment

- **ISO/IEC 27001:**
  - Covers all Annex A controls: information security policies, asset management, access control, cryptography, operations security, communications, and compliance.
- **ISO/IEC 42001 / 42005:**
  - AI/LLM-specific governance, transparency, and risk management are built into agent logic and workflow oversight.
- **Deloitte AI Agent Security Framework:**
  - The solution is mapped to Deloitte‚Äôs proprietary AI controls framework, covering governance, risk, transparency, explainability, data privacy, monitoring, and human oversight.
  - See: [Deloitte AI Agent Security Framework](../07_Reference/Deloitte AI Agent Security Framework.pdf).

---

### 7.3 Logging, Monitoring & Auditability

- **Comprehensive Logging:**
  - All actions, workflow steps, approvals, escalations, and remediation events are logged in **Azure Cosmos DB**.
- **Immutable Audit Trails:**
  - Audit logs are stored in Log Analytics and can be retained for regulatory review.
- **Monitoring & Alerting:**
  - Application Insights and Log Analytics provide real-time telemetry, alerting, and dashboards for suspicious activity.
- **Audit Reports:**
  - Power BI dashboards and compliance exports enable periodic and on-demand audit reviews.

---

### 7.4 Secure Development & Deployment

- **IaC Security:**
  - All infrastructure is versioned, reviewed, and deployed via Bicep templates and azd for repeatability and security.
- **Pipeline Security:**
  - All CI/CD runs require code review, secrets are injected at runtime, and pipeline logs are monitored.
- **Template Hardening:**
  - Sample code and config templates are security-reviewed before new client use.

---

For full mapping to security controls, see [Deloitte AI Agent Security Framework (PDF)](../07_Reference/Deloitte AI Agent Security Framework.pdf).

---
## 8. AI/LLM Governance & Responsible AI

This solution incorporates responsible AI practices and governance controls at every step of the workflow, supporting both internal standards and regulatory requirements such as ISO/IEC 42001.

---

### 8.1 Human Oversight

- **Human-in-the-Loop Review:**
  - All high-risk or automated decisions made by LLM agents are subject to explicit human review and approval before action.
- **Override & Audit:**
  - Security analysts can override LLM recommendations, with rationale logged for transparency.

---

### 8.2 Transparency & Explainability

- **LLM Agent Explainability:**
  - All risk scoring and remediation recommendations generated by the LLM include an explanation or justification field.
- **Decision Traceability:**
  - Each decision point is logged with input data, model version, and agent output.

---

### 8.3 Model Risk & Drift Monitoring

- **Model Versioning:**
  - All LLM calls log the specific deployment/model version in use for each decision.
- **Periodic Review:**
  - Model outputs, performance, and accuracy are periodically reviewed for bias, drift, or unexpected behavior.
- **Fallback & Escalation:**
  - Workflows support fallback to manual review if LLM confidence is low or unexpected outputs are detected.

---

### 8.4 Data Privacy & Protection

- **PII Minimization:**
  - Only the minimum data necessary for vulnerability triage is sent to LLMs; PII or sensitive business data is masked whenever possible.
- **Data Retention:**
  - All LLM inputs/outputs are stored in accordance with client and regulatory data retention policies.

---

### 8.5 Alignment with ISO/IEC 42001 & 42005

- **Governance Framework:**
  - AI/LLM agents, workflows, and audit trails are mapped to the requirements of ISO/IEC 42001 (AI Management System) and ISO/IEC 42005 (AI Risk).
- **Controls Mapping:**
  - See [Deloitte AI Agent Security Framework](../07_Reference/Deloitte AI Agent Security Framework.pdf) for full mapping to required controls.

---

*This ensures that every deployment of the VM Orchestration Template supports responsible AI, regulatory compliance, and trust for all users and stakeholders.*

---

## 9. Testing & Quality Assurance

This section describes the automated testing and quality practices built into the Vulnerability Management Orchestration template to ensure reliability, security, and ease of adaptation for each client.

---

### 9.1 Unit Testing

- **Coverage:**
  - All core agent modules (ingestion, triage, remediation, reporting) include unit tests covering normal, boundary, and error conditions.
- **Mocking External Dependencies:**
  - External API calls (scanners, ITSM, LLM) are mocked/stubbed in tests to enable repeatable and isolated test runs.
- **Sample Test Structure:**
  - All test files are located under `/tests/unit/` and follow the pattern `test_<module>.py` (for Python) or the language‚Äôs test conventions.

---

### 9.2 Integration Testing

- **End-to-End Workflows:**
  - Integration tests simulate real-world workflows (e.g., scan ingest ‚Üí triage ‚Üí approval ‚Üí remediation ticket) using sample or sandbox data.
- **Environment:**
  - Integration tests can be run in a dedicated dev/staging Azure environment or via local emulators.
- **Sample Test Files:**
  - Placed under `/tests/integration/` or `/tests/http/` (for API contract validation).

---

### 9.3 Security & Compliance Testing

- **Static Code Analysis:**
  - Pipelines include static analysis (e.g., linters, type checkers, code quality tools) to catch security and code issues before deployment.
- **Secrets Detection:**
  - Pre-commit and CI checks ensure no secrets are accidentally committed to the repo.
- **Vulnerability Scanning:**
  - CI runs dependency vulnerability scans on all agent, orchestrator, and UI packages.

---

### 9.4 CI/CD Integration

- **Automated Pipeline:**
  - All tests are run automatically on every pull request and before any deployment to Azure.
- **Test Failures Block Deployments:**
  - The CI/CD workflow requires all unit/integration/security tests to pass before a deployment can proceed.

---

### 9.5 Quality Gates & Best Practices

- **Test Coverage Targets:**
  - Aim for 80%+ code coverage on all core modules.
- **Test Data:**
  - Use sample data in `/tests/data/` for consistent, reusable test cases.
- **Continuous Improvement:**
  - Regularly review and update test suites as new agents or integrations are added.

---

*See `/tests/` and pipeline configuration files for test implementation details.*

---

## 10. Deployment & Operations

This section details how to deploy, monitor, and operate the Vulnerability Management Orchestration template for production and client environments.

---

### 10.1 Deployment Process

- **Automated Provisioning:**
  - All infrastructure and application code is deployed via Azure Developer CLI (`azd up`), using IaC (Bicep) templates and the `azure.yaml` configuration.
- **Configuration:**
  - All environment-specific settings (API endpoints, secrets, region, scaling) are managed via `.env` files and Azure Key Vault.
- **Zero Downtime:**
  - Deployments use rolling updates for agent microservices to minimize or eliminate downtime.
- **Rollback:**
  - CI/CD pipeline and azd support rollback to the last successful deployment in case of failure.

---

### 10.2 Operations & Monitoring

- **Live Monitoring:**
  - Azure Application Insights and Log Analytics are used to monitor agent health, workflow execution, and user activity.
- **Dashboards:**
  - Power BI dashboards display real-time vulnerability metrics, remediation SLAs, and compliance trends.
- **Alerts:**
  - Azure Monitor and Application Insights alerts notify operators of failures, bottlenecks, or anomalous activity (e.g., repeated scan errors, SLA breaches).
- **Audit & Access:**
  - All operator and analyst actions are logged in Cosmos DB and Log Analytics for audit review.

---

### 10.3 Maintenance & Support

- **Scaling:**
  - Container Apps can be horizontally scaled via Azure portal, CLI, or Bicep config to support higher throughput.
- **Updates:**
  - All agent, orchestrator, and UI code is versioned and deployed via CI/CD pipelines; update steps are documented in `README.md`.
- **Backup & Data Retention:**
  - Cosmos DB and other storage are configured with backup and retention policies in line with compliance requirements.
- **Disaster Recovery:**
  - Multi-region support, automated backups, and recovery runbooks ensure rapid restoration in case of incident.

---

### 10.4 Onboarding New Clients

- **Parameterize:**
  - Update configuration files for client-specific scanner endpoints, credentials, and reporting parameters.
- **Re-provision:**
  - Run `azd up` or redeploy from the latest template branch.
- **Customize UI & Branding:**
  - Modify front end as needed for client branding or workflow variations.

---

*See `/05_Infrastructure/`, pipeline config, and `README.md` for detailed deployment and operations steps.*

---

## 11. Extensibility & Future Roadmap

This section describes how the Vulnerability Management Orchestration template is designed to support rapid evolution, modularity, and adaptation for future business and technology needs.

---

### 11.1 Modular Agent Framework

- **Plug-and-Play Agents:**
  - New ingestion, enrichment, triage, remediation, or reporting agents can be added as independent microservices by creating new folders/modules under `src/agents/`.
- **Standardized Contracts:**
  - All agents adhere to common data models and API contracts, enabling consistent integration and rapid onboarding.
- **Template Stubs:**
  - Agent and API templates are provided in `src/templates/` for easy code generation and extension.

---

### 11.2 Adding New Integrations

- **Additional Scanners or Data Sources:**
  - Create new ingestion agents and register them with the orchestrator and IaC templates.
- **ITSM, SIEM, or Reporting Integrations:**
  - Add new remediation or reporting agents for different ITSM systems (e.g., ServiceNow, Jira, Freshservice) or reporting tools (Power BI, Tableau, custom APIs).
- **External Knowledge or RAG:**
  - Integrate with Azure Cognitive Search, vector stores, or RAG services for knowledge-based enrichment.

---

### 11.3 AI/LLM & Analytics Evolution

- **Model Upgrades:**
  - Swap LLM models (OpenAI, Azure AI, proprietary) by updating config and prompt templates.
- **New AI Agents:**
  - Add generative or predictive analytics modules (e.g., auto-remediation suggestions, anomaly detection).
- **Feedback Loops:**
  - Incorporate user/analyst feedback into model retraining or rules tuning for continuous improvement.

---

### 11.4 Deployment & Operations Flexibility

- **Multi-Cloud/Hybrid Ready:**
  - Adapt Bicep or IaC modules for other clouds or on-premise as needed.
- **Config-Driven Deployments:**
  - All business logic, data flows, and integrations are parameterized for per-client customization with minimal code changes.

---

### 11.5 Roadmap Ideas

- **SOAR Integration:**
  - Automate incident response and ticket enrichment via security orchestration tools.
- **Advanced GRC:**
  - Integrate with policy mapping, compliance evidence collection, and audit automation platforms.
- **Community & Open API:**
  - Provide open API docs and hooks for client or partner-developed agents, plugins, or reporting views.
- **AI Explainability:**
  - Expand explainability modules for regulatory and internal transparency.

---

*The architecture is designed for ‚Äúevolution by configuration‚Äù:
Update agents, flows, integrations, and client settings without disrupting the core template.*

---

## 12. Legend & Glossary

This section provides a quick reference for all icons, symbols, line styles, acronyms, and key terms used throughout the architecture and documentation.

---

### 12.1 Diagram Legend

| Symbol/Icon             | Meaning                                               |
|-------------------------|------------------------------------------------------|
| ü§ñ Robot                | AI Agent (LLM/AI-powered module, microservice)       |
| üë§ Person/User          | Security Analyst / Human-in-the-Loop                 |
| üñ•Ô∏è Monitor              | User Portal / Web UI                                 |
| üßπ Filter               | Processing Agent (Deduplication, Enrichment, etc.)   |
| üí° Azure OpenAI         | Azure OpenAI/Foundry Service                         |
| üìã Jira/Ticketing       | Remediation/Ticketing System (ServiceNow, Jira, etc.)|
| üìÑ File/Report          | Dashboard or Report Output                           |
| üìä Power BI             | Microsoft Power BI Dashboard                         |
| üõ¢Ô∏è Cosmos DB            | Azure Cosmos DB (Data Storage & Logging)             |
| üîê Key Vault            | Azure Key Vault (Secrets Management)                 |
| üìà Monitoring/Audit     | Azure Monitor, Log Analytics, Compliance             |

| Line Style              | Meaning                                              |
|-------------------------|------------------------------------------------------|
| Solid Line              | Main workflow/data process flow                      |
| Dashed Line             | Logging (event/state written to Cosmos DB)           |
| Dotted Line             | Secret/credential retrieval from Azure Key Vault     |

---

### 12.2 Glossary

- **AI Agent:**
  An automated module/microservice powered by LLM/AI (e.g., triage, enrichment, remediation).
- **Human-in-the-Loop:**
  Manual review/approval step for critical decisions (risk triage, remediation).
- **Orchestrator:**
  The central workflow engine that coordinates agents and tracks process state.
- **ITSM:**
  IT Service Management system (e.g., ServiceNow, Jira) for remediation/ticketing.
- **LLM:**
  Large Language Model (e.g., Azure OpenAI, GPT-4).
- **Power BI:**
  Microsoft‚Äôs analytics/dashboard platform for real-time and compliance reporting.
- **Key Vault:**
  Secure cloud service for storing secrets, API keys, and credentials.
- **Cosmos DB:**
  Globally distributed database for logs, tickets, and audit data.
- **RAG:**
  Retrieval-Augmented Generation (AI enrichment via search/knowledge base).
- **Bicep:**
  Azure-native Infrastructure-as-Code language for provisioning resources.
- **azd:**
  Azure Developer CLI‚Äîprovisions, deploys, and manages full-stack Azure projects.
- **RBAC:**
  Role-Based Access Control.

---

*Add to this glossary as your template evolves or as new modules/integrations are introduced.*

---

## Appendix

---

### A. References

- [Deloitte AI Agent Security Framework](../07_Reference/Deloitte AI Agent Security Framework.pdf)
- [ISO/IEC 27001:2022 ‚Äî Information Security Management](https://www.iso.org/standard/27001)
- [ISO/IEC 42001:2023 ‚Äî AI Management System](https://www.iso.org/standard/81226)
- [ISO/IEC 42005:2025 ‚Äî AI Impact Assessment & Controls](https://www.iso.org/standard/83870)
- [Microsoft Multi-Agent Custom Automation Engine Solution Accelerator](https://github.com/microsoft/Multi-Agent-Custom-Automation-Engine-Solution-Accelerator)
- [Azure AI Foundry](https://learn.microsoft.com/en-us/azure/ai-services/foundry/)
- [Azure Developer CLI Documentation](https://learn.microsoft.com/en-us/azure/developer/azure-developer-cli/)
- [Power BI Security Whitepaper](https://learn.microsoft.com/en-us/power-bi/enterprise/service-security)

---

### B. Control Mapping Matrix (Sample)

| Architecture Section            | Control Domain / Standard      | Deloitte AI Agent Framework | ISO 27001 | ISO 42001 | ISO 42005 |
|---------------------------------|-------------------------------|:--------------------------:|:---------:|:---------:|:---------:|
| Identity & Access Management    | IAM, RBAC                     | ‚úîÔ∏è                         | ‚úîÔ∏è        |           |           |
| Secrets Management (Key Vault)  | Cryptography, Secret Mgmt      | ‚úîÔ∏è                         | ‚úîÔ∏è        |           |           |
| LLM Governance & Oversight      | Responsible AI, Explainability | ‚úîÔ∏è                         |           | ‚úîÔ∏è        | ‚úîÔ∏è        |
| Logging & Audit Trails          | Monitoring, Compliance         | ‚úîÔ∏è                         | ‚úîÔ∏è        | ‚úîÔ∏è        |           |
| Model Risk & Drift Management   | AI Risk, Continuous Review     | ‚úîÔ∏è                         |           | ‚úîÔ∏è        | ‚úîÔ∏è        |
| Data Retention & Privacy        | Data Protection, GDPR          | ‚úîÔ∏è                         | ‚úîÔ∏è        | ‚úîÔ∏è        |           |
| CI/CD Security & Code Review    | SDLC, DevSecOps                | ‚úîÔ∏è                         | ‚úîÔ∏è        |           |           |

*(Expand this matrix as needed for client, audit, or compliance needs.)*

---

### C. Sample Workflow Trace

**Incident Example:**
1. Analyst initiates scan (Nexpose/Wiz) for asset group.
2. Ingestion agent fetches and normalizes 22 findings.
3. Processing agent deduplicates and enriches.
4. Triage agent assigns risk scores, flags 2 as critical.
5. Human-in-the-loop approves 1, rejects 1 (not relevant).
6. Remediation agent creates ServiceNow ticket for critical vuln.
7. Reporting agent updates Power BI dashboard and sends compliance email.
8. All actions and approvals are logged with timestamp/user in Cosmos DB and Log Analytics.

---

### D. Changelog & Contact

- **Version:** 1.0
- **Authors:** [Valerii Sysoiev]
- **Last Updated:** 2025-07-07
- **Contact:** [vasysoiev@deloitte.ca]

---

